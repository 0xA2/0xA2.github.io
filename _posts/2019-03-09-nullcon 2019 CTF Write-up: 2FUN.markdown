---
layout: post
title: "nullcon HackIM 2019 CTF Write-up: 2FUN"
description: "[write-up] Meet in the middle attack on 2DES-like cipher"
categories: "Writeups"
---
 <title>nullcon HackIM 2019 CTF Write-up: 2FUN - LostMyPlaintext</title> 
<img class="card-img-top" src="/assets/images/nullcon.png" alt="Card image cap">

<p></p>
<p>  Along side the challenge description above, we got the following python code: </p>

<div style="background: #ffffff; overflow:auto;width:auto;border:solid gray;border-width:.1em .1em .1em .8em;padding:.2em .6em;"><pre style="margin: 0; line-height: 125%"><span style="color: #f92672">from</span> <span style="color: #f8f8f2">hashlib</span> <span style="color: #f92672">import</span> <span style="color: #f8f8f2">md5</span>
<span style="color: #f92672">from</span> <span style="color: #f8f8f2">binascii</span> <span style="color: #f92672">import</span> <span style="color: #f8f8f2">hexlify,</span> <span style="color: #f8f8f2">unhexlify</span>
<span style="color: #f92672">from</span> <span style="color: #f8f8f2">secret</span> <span style="color: #f92672">import</span> <span style="color: #f8f8f2">key,</span> <span style="color: #f8f8f2">flag</span>
<span style="color: #f92672">import</span> <span style="color: #f8f8f2">sys</span>
<span style="color: #f8f8f2">BLOCK_LENGTH</span> <span style="color: #f92672">=</span> <span style="color: #ae81ff">16</span>
<span style="color: #f8f8f2">KEY_LENGTH</span> <span style="color: #f92672">=</span> <span style="color: #ae81ff">3</span>
<span style="color: #f8f8f2">ROUND_COUNT</span> <span style="color: #f92672">=</span> <span style="color: #ae81ff">16</span>

<span style="color: #f8f8f2">sbox</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">[</span><span style="color: #ae81ff">210</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">213</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">115</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">178</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">122</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">4</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">94</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">164</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">199</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">230</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">237</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">248</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">54</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">217</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">156</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">202</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">212</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">177</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">132</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">36</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">245</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">31</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">163</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">49</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">68</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">107</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">91</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">251</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">134</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">242</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">59</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">46</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">37</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">124</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">185</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">25</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">41</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">184</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">221</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">63</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">10</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">42</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">28</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">104</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">56</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">155</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">43</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">250</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">161</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">22</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">92</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">81</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">201</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">229</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">183</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">214</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">208</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">66</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">128</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">162</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">172</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">147</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">1</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">74</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">15</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">151</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">227</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">247</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">114</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">47</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">53</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">203</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">170</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">228</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">226</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">239</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">44</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">119</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">123</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">67</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">11</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">175</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">240</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">13</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">52</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">255</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">143</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">88</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">219</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">188</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">99</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">82</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">158</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">14</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">241</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">78</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">33</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">108</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">198</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">85</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">72</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">192</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">236</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">129</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">131</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">220</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">96</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">71</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">98</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">75</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">127</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">3</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">120</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">243</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">109</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">23</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">48</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">97</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">234</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">187</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">244</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">12</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">139</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">18</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">101</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">126</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">38</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">216</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">90</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">125</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">106</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">24</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">235</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">207</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">186</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">190</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">84</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">171</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">113</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">232</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">2</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">105</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">200</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">70</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">137</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">152</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">165</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">19</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">166</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">154</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">112</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">142</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">180</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">167</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">57</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">153</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">174</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">8</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">146</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">194</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">26</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">150</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">206</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">141</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">39</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">60</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">102</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">9</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">65</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">176</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">79</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">61</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">62</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">110</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">111</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">30</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">218</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">197</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">140</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">168</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">196</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">83</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">223</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">144</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">55</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">58</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">157</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">173</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">133</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">191</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">145</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">27</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">103</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">40</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">246</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">169</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">73</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">179</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">160</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">253</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">225</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">51</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">32</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">224</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">29</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">34</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">77</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">117</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">100</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">233</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">181</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">76</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">21</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">5</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">149</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">204</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">182</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">138</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">211</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">16</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">231</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">0</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">238</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">254</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">252</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">6</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">195</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">89</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">69</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">136</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">87</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">209</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">118</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">222</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">20</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">249</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">64</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">130</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">35</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">86</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">116</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">193</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">7</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">121</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">135</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">189</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">215</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">50</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">148</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">159</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">93</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">80</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">45</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">17</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">205</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">95</span><span style="color: #f8f8f2">]</span>

<span style="color: #f8f8f2">p</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">[</span><span style="color: #ae81ff">3</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">9</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">0</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">1</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">8</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">7</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">15</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">2</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">5</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">6</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">13</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">10</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">4</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">12</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">11</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">14</span><span style="color: #f8f8f2">]</span>

<span style="color: #66d9ef">def</span> <span style="color: #a6e22e">xor</span><span style="color: #f8f8f2">(a,</span> <span style="color: #f8f8f2">b):</span>
    <span style="color: #66d9ef">return</span> <span style="color: #f8f8f2">bytearray(map(</span><span style="color: #66d9ef">lambda</span> <span style="color: #f8f8f2">s:</span> <span style="color: #f8f8f2">s[</span><span style="color: #ae81ff">0</span><span style="color: #f8f8f2">]</span> <span style="color: #f92672">^</span> <span style="color: #f8f8f2">s[</span><span style="color: #ae81ff">1</span><span style="color: #f8f8f2">],</span> <span style="color: #f8f8f2">zip(a,</span> <span style="color: #f8f8f2">b)))</span>


<span style="color: #66d9ef">def</span> <span style="color: #a6e22e">fun</span><span style="color: #f8f8f2">(key,</span> <span style="color: #f8f8f2">pt):</span>
    <span style="color: #66d9ef">assert</span> <span style="color: #f8f8f2">len(pt)</span> <span style="color: #f92672">==</span> <span style="color: #f8f8f2">BLOCK_LENGTH</span>
    <span style="color: #66d9ef">assert</span> <span style="color: #f8f8f2">len(key)</span> <span style="color: #f92672">==</span> <span style="color: #f8f8f2">KEY_LENGTH</span>
    <span style="color: #f8f8f2">key</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">bytearray(unhexlify(md5(key)</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">hexdigest()))</span>
    <span style="color: #f8f8f2">ct</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">bytearray(pt)</span>
    <span style="color: #66d9ef">for</span> <span style="color: #f8f8f2">_</span> <span style="color: #f92672">in</span> <span style="color: #f8f8f2">range(ROUND_COUNT):</span>
        <span style="color: #f8f8f2">ct</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">xor(ct,</span> <span style="color: #f8f8f2">key)</span>
        <span style="color: #66d9ef">for</span> <span style="color: #f8f8f2">i</span> <span style="color: #f92672">in</span> <span style="color: #f8f8f2">range(BLOCK_LENGTH):</span>
            <span style="color: #f8f8f2">ct[i]</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">sbox[ct[i]]</span>
        <span style="color: #f8f8f2">nct</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">bytearray(BLOCK_LENGTH)</span>
        <span style="color: #66d9ef">for</span> <span style="color: #f8f8f2">i</span> <span style="color: #f92672">in</span> <span style="color: #f8f8f2">range(BLOCK_LENGTH):</span>
            <span style="color: #f8f8f2">nct[i]</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">ct[p[i]]</span>
        <span style="color: #f8f8f2">ct</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">nct</span>
    <span style="color: #66d9ef">return</span> <span style="color: #f8f8f2">hexlify(ct)</span>
<span style="color: #66d9ef">def</span> <span style="color: #a6e22e">toofun</span><span style="color: #f8f8f2">(key,</span> <span style="color: #f8f8f2">pt):</span>
    <span style="color: #66d9ef">assert</span> <span style="color: #f8f8f2">len(key)</span> <span style="color: #f92672">==</span> <span style="color: #ae81ff">2</span> <span style="color: #f92672">*</span> <span style="color: #f8f8f2">KEY_LENGTH</span>
    <span style="color: #f8f8f2">key1</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">key[:KEY_LENGTH]</span>
    <span style="color: #f8f8f2">key2</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">key[KEY_LENGTH:]</span>
    <span style="color: #f8f8f2">ct1</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">unhexlify(fun(key1,</span> <span style="color: #f8f8f2">pt))</span>
    <span style="color: #f8f8f2">ct2</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">fun(key2,</span> <span style="color: #f8f8f2">ct1)</span>
    <span style="color: #66d9ef">return</span> <span style="color: #f8f8f2">ct2</span>
<span style="color: #66d9ef">print</span><span style="color: #f8f8f2">(</span><span style="color: #e6db74">&quot;16 bit plaintext: %s&quot;</span> <span style="color: #f92672">%</span> <span style="color: #f8f8f2">toofun(key,</span> <span style="color: #f8f8f2">b</span><span style="color: #e6db74">&quot;16 bit plaintext&quot;</span><span style="color: #f8f8f2">))</span>
<span style="color: #66d9ef">print</span><span style="color: #f8f8f2">(</span><span style="color: #e6db74">&quot;flag: %s&quot;</span> <span style="color: #f92672">%</span> <span style="color: #f8f8f2">toofun(key,</span> <span style="color: #f8f8f2">flag))</span>
</pre></div>
<p></p>
 <p> Like the challenge description suggests, a 6 byte key is too big to be bruteforced since there are 256<sup>6</sup> possible keys (in other words waaay to many), however the "toofun" function splits the key in half. Each half is used seperatly for encryption when passed to the "fun" function. With this, along side the given plaintext example ("16 bit plaintext") and the corresponding ciphertext ("b'0467a52afa8f15cfb8f0ea40365a6692'") we can establish a <b>Meet In The Middle Attack</b> (the same vulnerability that affects 2-DES) by bruteforcing all possible 3 byte keys instead of 6. If we code the reverse of the "fun" function and pass all  possible  keys  to  <b>fun(key,"16 bit plaintext")</b> and <b>reversed_fun(key,b'0467a52afa8f15cfb8f0ea40365a6692')</b> there will be a certain pair of keys (let's call them keyA and keyB) such that <b>fun(keyA,"16 bit plaintext")</b> is equal to <b>reversed_fun(keyB,b'0467a52afa8f15cfb8f0ea40365a6692')</b></p>
            
<p>Our original key will be the concatenation of keyA with keyB.</p>

 <p>First I wrote a simple function to help invert the permutation schemes created using "p" and "sbox".</p>


<div style="background: #272822; overflow:auto;width:auto;border:solid gray;border-width:.1em .1em .1em .8em;padding:.2em .6em;"><pre style="margin: 0; line-height: 125%"><span style="color: #f8f8f2">sbox</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">[</span><span style="color: #ae81ff">210</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">213</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">115</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">178</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">122</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">4</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">94</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">164</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">199</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">230</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">237</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">248</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">54</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">217</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">156</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">202</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">212</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">177</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">132</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">36</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">245</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">31</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">163</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">49</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">68</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">107</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">91</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">251</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">134</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">242</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">59</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">46</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">37</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">124</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">185</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">25</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">41</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">184</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">221</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">63</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">10</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">42</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">28</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">104</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">56</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">155</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">43</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">250</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">161</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">22</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">92</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">81</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">201</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">229</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">183</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">214</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">208</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">66</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">128</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">162</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">172</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">147</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">1</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">74</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">15</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">151</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">227</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">247</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">114</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">47</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">53</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">203</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">170</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">228</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">226</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">239</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">44</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">119</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">123</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">67</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">11</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">175</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">240</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">13</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">52</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">255</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">143</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">88</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">219</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">188</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">99</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">82</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">158</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">14</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">241</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">78</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">33</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">108</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">198</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">85</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">72</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">192</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">236</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">129</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">131</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">220</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">96</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">71</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">98</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">75</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">127</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">3</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">120</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">243</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">109</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">23</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">48</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">97</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">234</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">187</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">244</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">12</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">139</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">18</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">101</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">126</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">38</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">216</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">90</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">125</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">106</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">24</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">235</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">207</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">186</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">190</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">84</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">171</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">113</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">232</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">2</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">105</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">200</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">70</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">137</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">152</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">165</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">19</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">166</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">154</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">112</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">142</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">180</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">167</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">57</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">153</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">174</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">8</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">146</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">194</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">26</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">150</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">206</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">141</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">39</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">60</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">102</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">9</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">65</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">176</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">79</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">61</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">62</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">110</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">111</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">30</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">218</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">197</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">140</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">168</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">196</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">83</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">223</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">144</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">55</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">58</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">157</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">173</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">133</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">191</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">145</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">27</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">103</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">40</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">246</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">169</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">73</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">179</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">160</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">253</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">225</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">51</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">32</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">224</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">29</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">34</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">77</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">117</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">100</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">233</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">181</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">76</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">21</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">5</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">149</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">204</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">182</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">138</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">211</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">16</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">231</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">0</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">238</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">254</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">252</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">6</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">195</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">89</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">69</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">136</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">87</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">209</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">118</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">222</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">20</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">249</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">64</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">130</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">35</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">86</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">116</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">193</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">7</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">121</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">135</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">189</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">215</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">50</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">148</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">159</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">93</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">80</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">45</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">17</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">205</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">95</span><span style="color: #f8f8f2">]</span>

<span style="color: #f8f8f2">p</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">[</span><span style="color: #ae81ff">3</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">9</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">0</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">1</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">8</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">7</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">15</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">2</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">5</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">6</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">13</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">10</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">4</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">12</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">11</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">14</span><span style="color: #f8f8f2">]</span>

<span style="color: #66d9ef">def</span> <span style="color: #a6e22e">inversePerm</span><span style="color: #f8f8f2">(p):</span>
  <span style="color: #f8f8f2">ret</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">[]</span>
  <span style="color: #66d9ef">for</span> <span style="color: #f8f8f2">i</span> <span style="color: #f92672">in</span> <span style="color: #f8f8f2">range(</span><span style="color: #ae81ff">0</span><span style="color: #f8f8f2">,len(p)):</span>
    <span style="color: #f8f8f2">ret</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">append(i)</span>
  <span style="color: #66d9ef">for</span> <span style="color: #f8f8f2">i</span> <span style="color: #f92672">in</span> <span style="color: #f8f8f2">range(</span><span style="color: #ae81ff">0</span><span style="color: #f8f8f2">,len(p)):</span>
    <span style="color: #f8f8f2">ret[p[i]]</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">i</span>
  <span style="color: #66d9ef">return</span> <span style="color: #f8f8f2">ret</span>


<span style="color: #f8f8f2">invert_p</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">inversePerm(p)</span>
<span style="color: #f8f8f2">invert_sbox</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">inversePerm(sbox)</span>
</pre></div>
   <p></p>
And then a reverse version of the original "fun" function.

  <div style="background: #272822; overflow:auto;width:auto;border:solid gray;border-width:.1em .1em .1em .8em;padding:.2em .6em;"><pre style="margin: 0; line-height: 125%"><span style="color: #66d9ef">def</span> <span style="color: #a6e22e">no_fun_allowed</span><span style="color: #f8f8f2">(key,</span> <span style="color: #f8f8f2">ct):</span>
  <span style="color: #f8f8f2">ct</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">unhexlify(ct)</span>
  <span style="color: #f8f8f2">key</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">bytearray(unhexlify(md5(key)</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">hexdigest()))</span>
  <span style="color: #f8f8f2">mitm</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">bytearray(ct)</span>
  <span style="color: #66d9ef">for</span> <span style="color: #f8f8f2">_</span> <span style="color: #f92672">in</span> <span style="color: #f8f8f2">range(ROUND_COUNT):</span>
   <span style="color: #f8f8f2">nct</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">bytearray(BLOCK_LENGTH)</span>
   <span style="color: #66d9ef">for</span> <span style="color: #f8f8f2">i</span> <span style="color: #f92672">in</span> <span style="color: #f8f8f2">range(BLOCK_LENGTH):</span>
   <span style="color: #f8f8f2">nct[i]</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">mitm[invert_p[i]]</span>
   <span style="color: #f8f8f2">mitm</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">nct</span>
   <span style="color: #66d9ef">for</span> <span style="color: #f8f8f2">i</span> <span style="color: #f92672">in</span> <span style="color: #f8f8f2">range(BLOCK_LENGTH):</span>
   <span style="color: #f8f8f2">mitm[i]</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">invert_sbox[mitm[i]]</span>
   <span style="color: #f8f8f2">mitm</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">xor(mitm,key)</span>
  <span style="color: #66d9ef">return</span> <span style="color: #f8f8f2">hexlify(mitm)</span>
</pre></div>
 <p></p>
 <p>Now we're ready to iterate through all possible keys. We'll be passing them as arguments to both the "fun" function and our newly created "no_fun_allowed" function as discussed previously. I chose to save the respective outputs to seperate files as you can see below.</p>

   <div style="background: #272822; overflow:auto;width:auto;border:solid gray;border-width:.1em .1em .1em .8em;padding:.2em .6em;"><pre style="margin: 0; line-height: 125%"><span style="color: #75715e"># Stage 0 - Collect all possible keys</span>

<span style="color: #f8f8f2">ptout</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">open(</span><span style="color: #e6db74">&quot;ptOutput.txt&quot;</span><span style="color: #f8f8f2">,</span><span style="color: #e6db74">&quot;w&quot;</span><span style="color: #f8f8f2">)</span>
<span style="color: #f8f8f2">ctout</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">open(</span><span style="color: #e6db74">&quot;ctOutput.txt&quot;</span><span style="color: #f8f8f2">,</span><span style="color: #e6db74">&quot;w&quot;</span><span style="color: #f8f8f2">)</span>
<span style="color: #66d9ef">for</span> <span style="color: #f8f8f2">i</span> <span style="color: #f92672">in</span> <span style="color: #f8f8f2">range(</span><span style="color: #ae81ff">0</span><span style="color: #f8f8f2">,</span><span style="color: #ae81ff">256</span><span style="color: #f8f8f2">):</span>
  <span style="color: #66d9ef">for</span> <span style="color: #f8f8f2">j</span> <span style="color: #f92672">in</span> <span style="color: #f8f8f2">range(</span><span style="color: #ae81ff">0</span><span style="color: #f8f8f2">,</span><span style="color: #ae81ff">256</span><span style="color: #f8f8f2">):</span>
    <span style="color: #66d9ef">for</span> <span style="color: #f8f8f2">k</span> <span style="color: #f92672">in</span> <span style="color: #f8f8f2">range(</span><span style="color: #ae81ff">0</span><span style="color: #f8f8f2">,</span><span style="color: #ae81ff">256</span><span style="color: #f8f8f2">):</span>
      <span style="color: #f8f8f2">key</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">bytearray(</span><span style="color: #ae81ff">3</span><span style="color: #f8f8f2">)</span>
      <span style="color: #f8f8f2">key[</span><span style="color: #ae81ff">0</span><span style="color: #f8f8f2">]</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">i;</span> <span style="color: #f8f8f2">key[</span><span style="color: #ae81ff">1</span><span style="color: #f8f8f2">]</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">j;</span> <span style="color: #f8f8f2">key[</span><span style="color: #ae81ff">2</span><span style="color: #f8f8f2">]</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">k</span>
      <span style="color: #f8f8f2">ptout</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">write(hexlify(key)</span> <span style="color: #f92672">+</span> <span style="color: #e6db74">&quot; :: &quot;</span> <span style="color: #f92672">+</span> <span style="color: #f8f8f2">fun(key,b</span><span style="color: #e6db74">&#39;16 bit plaintext&#39;</span><span style="color: #f8f8f2">)</span> <span style="color: #f92672">+</span> <span style="color: #e6db74">&quot;</span><span style="color: #ae81ff">\n</span><span style="color: #e6db74">&quot;</span><span style="color: #f8f8f2">)</span>
      <span style="color: #f8f8f2">ctout</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">write(hexlify(key)</span> <span style="color: #f92672">+</span> <span style="color: #e6db74">&quot; :: &quot;</span> <span style="color: #f92672">+</span> <span style="color: #f8f8f2">no_fun_allowed(key,b</span><span style="color: #e6db74">&#39;0467a52afa8f15cfb8f0ea40365a6692&#39;</span><span style="color: #f8f8f2">)</span> <span style="color: #f92672">+</span> <span style="color: #e6db74">&quot;</span><span style="color: #ae81ff">\n</span><span style="color: #e6db74">&quot;</span><span style="color: #f8f8f2">)</span>
<span style="color: #f8f8f2">ptout</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">close()</span>
<span style="color: #f8f8f2">ctout</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">close()</span>
</pre></div>


<p></p>
<p>I then used python sets to find the hash that's common to both files, which turned out to be: <b>36e8c221ea84efcaab2c393786f938d0</b></p>



<div style="background: #272822; overflow:auto;width:auto;border:solid gray;border-width:.1em .1em .1em .8em;padding:.2em .6em;"><pre style="margin: 0; line-height: 125%"><span style="color: #75715e"># Stage 1 - Find Meet In The Middle Collision</span>

<span style="color: #f8f8f2">ptSet</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">set(line</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">split(</span><span style="color: #e6db74">&quot; &quot;</span><span style="color: #f8f8f2">)[</span><span style="color: #ae81ff">2</span><span style="color: #f8f8f2">]</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">strip()</span> <span style="color: #66d9ef">for</span> <span style="color: #f8f8f2">line</span> <span style="color: #f92672">in</span> <span style="color: #f8f8f2">open(</span><span style="color: #e6db74">&quot;ptOutput.txt&quot;</span><span style="color: #f8f8f2">,</span><span style="color: #e6db74">&quot;r&quot;</span><span style="color: #f8f8f2">))</span>
<span style="color: #f8f8f2">ctSet</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">set(line</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">split(</span><span style="color: #e6db74">&quot; &quot;</span><span style="color: #f8f8f2">)[</span><span style="color: #ae81ff">2</span><span style="color: #f8f8f2">]</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">strip()</span> <span style="color: #66d9ef">for</span> <span style="color: #f8f8f2">line</span> <span style="color: #f92672">in</span> <span style="color: #f8f8f2">open(</span><span style="color: #e6db74">&quot;ctOutput.txt&quot;</span><span style="color: #f8f8f2">,</span><span style="color: #e6db74">&quot;r&quot;</span><span style="color: #f8f8f2">))</span>

<span style="color: #f8f8f2">collision</span> <span style="color: #f92672">=</span>  <span style="color: #f8f8f2">ptSet</span> <span style="color: #f92672">&amp;</span> <span style="color: #f8f8f2">ctSet</span>
<span style="color: #66d9ef">print</span> <span style="color: #e6db74">&quot;Collision &gt; &quot;</span> <span style="color: #f92672">+</span> <span style="color: #f8f8f2">collision</span>
</pre></div>


<p></p>
<p>With the common hash in hand we can now recover both halfs of the original key. When concatenated we get the original key: <b>a277b5c1bc8b</b></p>

  <div style="background: #272822; overflow:auto;width:auto;border:solid gray;border-width:.1em .1em .1em .8em;padding:.2em .6em;"><pre style="margin: 0; line-height: 125%"><span style="color: #75715e"># Stage 2 - Get Key</span>

<span style="color: #f8f8f2">key</span> <span style="color: #f92672">=</span> <span style="color: #e6db74">&quot;&quot;</span>
<span style="color: #66d9ef">with</span> <span style="color: #f8f8f2">open(</span><span style="color: #e6db74">&quot;ptOutput.txt&quot;</span><span style="color: #f8f8f2">,</span><span style="color: #e6db74">&quot;r&quot;</span><span style="color: #f8f8f2">)</span> <span style="color: #66d9ef">as</span> <span style="color: #f8f8f2">f:</span>
  <span style="color: #66d9ef">for</span> <span style="color: #f8f8f2">line</span> <span style="color: #f92672">in</span> <span style="color: #f8f8f2">f:</span>
    <span style="color: #66d9ef">if</span> <span style="color: #f8f8f2">line</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">split(</span><span style="color: #e6db74">&quot; &quot;</span><span style="color: #f8f8f2">)[</span><span style="color: #ae81ff">2</span><span style="color: #f8f8f2">]</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">strip()</span> <span style="color: #f92672">==</span> <span style="color: #f8f8f2">collision:</span>
      <span style="color: #66d9ef">print</span> <span style="color: #e6db74">&quot;Left side key &gt; &quot;</span> <span style="color: #f92672">+</span> <span style="color: #f8f8f2">line</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">split(</span><span style="color: #e6db74">&quot; &quot;</span><span style="color: #f8f8f2">)[</span><span style="color: #ae81ff">0</span><span style="color: #f8f8f2">]</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">strip()</span>
      <span style="color: #f8f8f2">key</span> <span style="color: #f92672">+=</span> <span style="color: #f8f8f2">line</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">split(</span><span style="color: #e6db74">&quot; &quot;</span><span style="color: #f8f8f2">)[</span><span style="color: #ae81ff">0</span><span style="color: #f8f8f2">]</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">strip()</span>
<span style="color: #66d9ef">with</span> <span style="color: #f8f8f2">open(</span><span style="color: #e6db74">&quot;ctOutput.txt&quot;</span><span style="color: #f8f8f2">,</span><span style="color: #e6db74">&quot;r&quot;</span><span style="color: #f8f8f2">)</span> <span style="color: #66d9ef">as</span> <span style="color: #f8f8f2">f:</span>
  <span style="color: #66d9ef">for</span> <span style="color: #f8f8f2">line</span> <span style="color: #f92672">in</span> <span style="color: #f8f8f2">f:</span>
    <span style="color: #66d9ef">if</span> <span style="color: #f8f8f2">line</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">split(</span><span style="color: #e6db74">&quot; &quot;</span><span style="color: #f8f8f2">)[</span><span style="color: #ae81ff">2</span><span style="color: #f8f8f2">]</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">strip()</span> <span style="color: #f92672">==</span> <span style="color: #f8f8f2">collision:</span>
      <span style="color: #66d9ef">print</span> <span style="color: #e6db74">&quot;Right side key &gt; &quot;</span> <span style="color: #f92672">+</span> <span style="color: #f8f8f2">line</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">split(</span><span style="color: #e6db74">&quot; &quot;</span><span style="color: #f8f8f2">)[</span><span style="color: #ae81ff">0</span><span style="color: #f8f8f2">]</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">strip()</span>
      <span style="color: #f8f8f2">key</span> <span style="color: #f92672">+=</span> <span style="color: #f8f8f2">line</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">split(</span><span style="color: #e6db74">&quot; &quot;</span><span style="color: #f8f8f2">)[</span><span style="color: #ae81ff">0</span><span style="color: #f8f8f2">]</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">strip()</span>
<span style="color: #66d9ef">print</span> <span style="color: #e6db74">&quot;Key &gt; &quot;</span> <span style="color: #f92672">+</span> <span style="color: #f8f8f2">key</span>
</pre></div>


 <p></p>
 <p>Finally all that's left is to recover the flag by reversing the "toofun" function.</p>
          
<div style="background: #272822; overflow:auto;width:auto;border:solid gray;border-width:.1em .1em .1em .8em;padding:.2em .6em;"><pre style="margin: 0; line-height: 125%"><span style="color: #75715e"># Stage 3 - Get Flag</span>

<span style="color: #f8f8f2">flag</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">b</span><span style="color: #e6db74">&#39;04b34e5af4a1f5260f6043b8b9abb4f8&#39;</span>
<span style="color: #f8f8f2">key</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">unhexlify(key)</span>

<span style="color: #66d9ef">def</span> <span style="color: #a6e22e">not_so_fun_anymore</span><span style="color: #f8f8f2">(key,ct):</span>
  <span style="color: #66d9ef">assert</span> <span style="color: #f8f8f2">len(key)</span> <span style="color: #f92672">==</span> <span style="color: #ae81ff">2</span> <span style="color: #f92672">*</span> <span style="color: #f8f8f2">KEY_LENGTH</span>
  <span style="color: #f8f8f2">key1</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">key[:KEY_LENGTH]</span>
  <span style="color: #f8f8f2">key2</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">key[KEY_LENGTH:]</span>

  <span style="color: #f8f8f2">hash</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">no_fun_allowed(key2,</span> <span style="color: #f8f8f2">ct)</span>
  <span style="color: #f8f8f2">pt</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">no_fun_allowed(key1,hash)</span>
  <span style="color: #66d9ef">return</span> <span style="color: #f8f8f2">pt</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">decode(</span><span style="color: #e6db74">&quot;hex&quot;</span><span style="color: #f8f8f2">)</span>

<span style="color: #66d9ef">print</span> <span style="color: #e6db74">&quot;hackim19{&quot;</span> <span style="color: #f92672">+</span> <span style="color: #f8f8f2">not_so_fun_anymore(key,flag)</span> <span style="color: #f92672">+</span> <span style="color: #e6db74">&quot;}&quot;</span>
</pre></div>
<p></p>
<p>As a result we get the flag: <b>hackim19{1337_1n_m1ddl38f}</b></p>
<p></p>
<p><b>Full Solver:</b></p>

 <div style="background: #272822; overflow:auto;width:auto;border:solid gray;border-width:.1em .1em .1em .8em;padding:.2em .6em;"><pre style="margin: 0; line-height: 125%"><span style="color: #f92672">from</span> <span style="color: #f8f8f2">hashlib</span> <span style="color: #f92672">import</span> <span style="color: #f8f8f2">md5</span>
<span style="color: #f92672">from</span> <span style="color: #f8f8f2">binascii</span> <span style="color: #f92672">import</span> <span style="color: #f8f8f2">hexlify,</span> <span style="color: #f8f8f2">unhexlify</span>
<span style="color: #f92672">import</span> <span style="color: #f8f8f2">sys</span>
<span style="color: #f92672">import</span> <span style="color: #f8f8f2">os</span>
<span style="color: #f8f8f2">BLOCK_LENGTH</span> <span style="color: #f92672">=</span> <span style="color: #ae81ff">16</span>
<span style="color: #f8f8f2">KEY_LENGTH</span> <span style="color: #f92672">=</span> <span style="color: #ae81ff">3</span>
<span style="color: #f8f8f2">ROUND_COUNT</span> <span style="color: #f92672">=</span> <span style="color: #ae81ff">16</span>

<span style="color: #f8f8f2">sbox</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">[</span><span style="color: #ae81ff">210</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">213</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">115</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">178</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">122</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">4</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">94</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">164</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">199</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">230</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">237</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">248</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">54</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">217</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">156</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">202</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">212</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">177</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">132</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">36</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">245</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">31</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">163</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">49</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">68</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">107</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">91</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">251</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">134</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">242</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">59</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">46</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">37</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">124</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">185</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">25</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">41</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">184</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">221</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">63</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">10</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">42</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">28</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">104</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">56</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">155</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">43</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">250</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">161</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">22</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">92</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">81</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">201</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">229</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">183</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">214</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">208</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">66</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">128</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">162</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">172</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">147</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">1</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">74</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">15</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">151</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">227</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">247</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">114</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">47</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">53</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">203</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">170</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">228</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">226</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">239</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">44</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">119</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">123</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">67</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">11</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">175</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">240</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">13</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">52</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">255</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">143</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">88</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">219</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">188</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">99</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">82</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">158</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">14</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">241</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">78</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">33</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">108</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">198</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">85</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">72</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">192</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">236</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">129</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">131</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">220</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">96</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">71</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">98</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">75</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">127</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">3</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">120</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">243</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">109</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">23</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">48</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">97</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">234</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">187</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">244</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">12</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">139</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">18</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">101</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">126</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">38</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">216</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">90</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">125</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">106</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">24</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">235</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">207</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">186</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">190</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">84</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">171</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">113</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">232</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">2</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">105</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">200</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">70</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">137</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">152</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">165</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">19</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">166</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">154</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">112</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">142</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">180</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">167</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">57</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">153</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">174</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">8</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">146</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">194</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">26</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">150</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">206</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">141</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">39</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">60</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">102</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">9</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">65</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">176</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">79</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">61</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">62</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">110</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">111</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">30</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">218</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">197</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">140</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">168</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">196</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">83</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">223</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">144</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">55</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">58</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">157</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">173</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">133</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">191</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">145</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">27</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">103</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">40</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">246</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">169</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">73</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">179</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">160</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">253</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">225</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">51</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">32</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">224</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">29</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">34</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">77</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">117</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">100</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">233</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">181</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">76</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">21</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">5</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">149</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">204</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">182</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">138</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">211</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">16</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">231</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">0</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">238</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">254</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">252</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">6</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">195</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">89</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">69</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">136</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">87</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">209</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">118</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">222</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">20</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">249</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">64</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">130</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">35</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">86</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">116</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">193</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">7</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">121</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">135</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">189</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">215</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">50</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">148</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">159</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">93</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">80</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">45</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">17</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">205</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">95</span><span style="color: #f8f8f2">]</span>

<span style="color: #f8f8f2">p</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">[</span><span style="color: #ae81ff">3</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">9</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">0</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">1</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">8</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">7</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">15</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">2</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">5</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">6</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">13</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">10</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">4</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">12</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">11</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">14</span><span style="color: #f8f8f2">]</span>

<span style="color: #66d9ef">def</span> <span style="color: #a6e22e">inversePerm</span><span style="color: #f8f8f2">(p):</span>
  <span style="color: #f8f8f2">ret</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">[]</span>
  <span style="color: #66d9ef">for</span> <span style="color: #f8f8f2">i</span> <span style="color: #f92672">in</span> <span style="color: #f8f8f2">range(</span><span style="color: #ae81ff">0</span><span style="color: #f8f8f2">,len(p)):</span>
    <span style="color: #f8f8f2">ret</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">append(i)</span>
  <span style="color: #66d9ef">for</span> <span style="color: #f8f8f2">i</span> <span style="color: #f92672">in</span> <span style="color: #f8f8f2">range(</span><span style="color: #ae81ff">0</span><span style="color: #f8f8f2">,len(p)):</span>
    <span style="color: #f8f8f2">ret[p[i]]</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">i</span>
  <span style="color: #66d9ef">return</span> <span style="color: #f8f8f2">ret</span>


<span style="color: #f8f8f2">invert_p</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">inversePerm(p)</span>
<span style="color: #f8f8f2">invert_sbox</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">inversePerm(sbox)</span>

<span style="color: #66d9ef">def</span> <span style="color: #a6e22e">xor</span><span style="color: #f8f8f2">(a,</span> <span style="color: #f8f8f2">b):</span>
  <span style="color: #66d9ef">return</span> <span style="color: #f8f8f2">bytearray(map(</span><span style="color: #66d9ef">lambda</span> <span style="color: #f8f8f2">s:</span> <span style="color: #f8f8f2">s[</span><span style="color: #ae81ff">0</span><span style="color: #f8f8f2">]</span> <span style="color: #f92672">^</span> <span style="color: #f8f8f2">s[</span><span style="color: #ae81ff">1</span><span style="color: #f8f8f2">],</span> <span style="color: #f8f8f2">zip(a,</span> <span style="color: #f8f8f2">b)))</span>


<span style="color: #66d9ef">def</span> <span style="color: #a6e22e">fun</span><span style="color: #f8f8f2">(key,</span> <span style="color: #f8f8f2">pt):</span>
  <span style="color: #66d9ef">assert</span> <span style="color: #f8f8f2">len(pt)</span> <span style="color: #f92672">==</span> <span style="color: #f8f8f2">BLOCK_LENGTH</span>
  <span style="color: #66d9ef">assert</span> <span style="color: #f8f8f2">len(key)</span> <span style="color: #f92672">==</span> <span style="color: #f8f8f2">KEY_LENGTH</span>
  <span style="color: #f8f8f2">key</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">bytearray(unhexlify(md5(key)</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">hexdigest()))</span>
  <span style="color: #f8f8f2">ct</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">bytearray(pt)</span>
  <span style="color: #66d9ef">for</span> <span style="color: #f8f8f2">_</span> <span style="color: #f92672">in</span> <span style="color: #f8f8f2">range(ROUND_COUNT):</span>
    <span style="color: #f8f8f2">ct</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">xor(ct,</span> <span style="color: #f8f8f2">key)</span>
    <span style="color: #66d9ef">for</span> <span style="color: #f8f8f2">i</span> <span style="color: #f92672">in</span> <span style="color: #f8f8f2">range(BLOCK_LENGTH):</span>
      <span style="color: #f8f8f2">ct[i]</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">sbox[ct[i]]</span>
    <span style="color: #f8f8f2">nct</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">bytearray(BLOCK_LENGTH)</span>
    <span style="color: #66d9ef">for</span> <span style="color: #f8f8f2">i</span> <span style="color: #f92672">in</span> <span style="color: #f8f8f2">range(BLOCK_LENGTH):</span>
      <span style="color: #f8f8f2">nct[i]</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">ct[p[i]]</span>
    <span style="color: #f8f8f2">ct</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">nct</span>
  <span style="color: #66d9ef">return</span> <span style="color: #f8f8f2">hexlify(ct)</span>

<span style="color: #66d9ef">def</span> <span style="color: #a6e22e">no_fun_allowed</span><span style="color: #f8f8f2">(key,</span> <span style="color: #f8f8f2">ct):</span>
  <span style="color: #f8f8f2">ct</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">unhexlify(ct)</span>
  <span style="color: #f8f8f2">key</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">bytearray(unhexlify(md5(key)</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">hexdigest()))</span>
  <span style="color: #f8f8f2">mitm</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">bytearray(ct)</span>
  <span style="color: #66d9ef">for</span> <span style="color: #f8f8f2">_</span> <span style="color: #f92672">in</span> <span style="color: #f8f8f2">range(ROUND_COUNT):</span>
    <span style="color: #f8f8f2">nct</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">bytearray(BLOCK_LENGTH)</span>
    <span style="color: #66d9ef">for</span> <span style="color: #f8f8f2">i</span> <span style="color: #f92672">in</span> <span style="color: #f8f8f2">range(BLOCK_LENGTH):</span>
      <span style="color: #f8f8f2">nct[i]</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">mitm[invert_p[i]]</span>
    <span style="color: #f8f8f2">mitm</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">nct</span>
    <span style="color: #66d9ef">for</span> <span style="color: #f8f8f2">i</span> <span style="color: #f92672">in</span> <span style="color: #f8f8f2">range(BLOCK_LENGTH):</span>
      <span style="color: #f8f8f2">mitm[i]</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">invert_sbox[mitm[i]]</span>
    <span style="color: #f8f8f2">mitm</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">xor(mitm,key)</span>
  <span style="color: #66d9ef">return</span> <span style="color: #f8f8f2">hexlify(mitm)</span>


<span style="color: #75715e"># Stage 0 - Collect all possible keys</span>

<span style="color: #f8f8f2">ptout</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">open(</span><span style="color: #e6db74">&quot;ptOutput.txt&quot;</span><span style="color: #f8f8f2">,</span><span style="color: #e6db74">&quot;w&quot;</span><span style="color: #f8f8f2">)</span>
<span style="color: #f8f8f2">ctout</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">open(</span><span style="color: #e6db74">&quot;ctOutput.txt&quot;</span><span style="color: #f8f8f2">,</span><span style="color: #e6db74">&quot;w&quot;</span><span style="color: #f8f8f2">)</span>
<span style="color: #66d9ef">for</span> <span style="color: #f8f8f2">i</span> <span style="color: #f92672">in</span> <span style="color: #f8f8f2">range(</span><span style="color: #ae81ff">0</span><span style="color: #f8f8f2">,</span><span style="color: #ae81ff">256</span><span style="color: #f8f8f2">):</span>
  <span style="color: #66d9ef">for</span> <span style="color: #f8f8f2">j</span> <span style="color: #f92672">in</span> <span style="color: #f8f8f2">range(</span><span style="color: #ae81ff">0</span><span style="color: #f8f8f2">,</span><span style="color: #ae81ff">256</span><span style="color: #f8f8f2">):</span>
    <span style="color: #66d9ef">for</span> <span style="color: #f8f8f2">k</span> <span style="color: #f92672">in</span> <span style="color: #f8f8f2">range(</span><span style="color: #ae81ff">0</span><span style="color: #f8f8f2">,</span><span style="color: #ae81ff">256</span><span style="color: #f8f8f2">):</span>
      <span style="color: #f8f8f2">key</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">bytearray(</span><span style="color: #ae81ff">3</span><span style="color: #f8f8f2">)</span>
      <span style="color: #f8f8f2">key[</span><span style="color: #ae81ff">0</span><span style="color: #f8f8f2">]</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">i;</span> <span style="color: #f8f8f2">key[</span><span style="color: #ae81ff">1</span><span style="color: #f8f8f2">]</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">j;</span> <span style="color: #f8f8f2">key[</span><span style="color: #ae81ff">2</span><span style="color: #f8f8f2">]</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">k</span>
      <span style="color: #f8f8f2">ptout</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">write(hexlify(key)</span> <span style="color: #f92672">+</span> <span style="color: #e6db74">&quot; :: &quot;</span> <span style="color: #f92672">+</span> <span style="color: #f8f8f2">fun(key,b</span><span style="color: #e6db74">&#39;16 bit plaintext&#39;</span><span style="color: #f8f8f2">)</span> <span style="color: #f92672">+</span> <span style="color: #e6db74">&quot;</span><span style="color: #ae81ff">\n</span><span style="color: #e6db74">&quot;</span><span style="color: #f8f8f2">)</span>
      <span style="color: #f8f8f2">ctout</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">write(hexlify(key)</span> <span style="color: #f92672">+</span> <span style="color: #e6db74">&quot; :: &quot;</span> <span style="color: #f92672">+</span> <span style="color: #f8f8f2">no_fun_allowed(key,b</span><span style="color: #e6db74">&#39;0467a52afa8f15cfb8f0ea40365a6692&#39;</span><span style="color: #f8f8f2">)</span> <span style="color: #f92672">+</span> <span style="color: #e6db74">&quot;</span><span style="color: #ae81ff">\n</span><span style="color: #e6db74">&quot;</span><span style="color: #f8f8f2">)</span>
<span style="color: #f8f8f2">ptout</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">close()</span>
<span style="color: #f8f8f2">ctout</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">close()</span>


<span style="color: #75715e"># Stage 1 - Find Meet In The Middle Collision</span>

<span style="color: #f8f8f2">ptSet</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">set(line</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">split(</span><span style="color: #e6db74">&quot; &quot;</span><span style="color: #f8f8f2">)[</span><span style="color: #ae81ff">2</span><span style="color: #f8f8f2">]</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">strip()</span> <span style="color: #66d9ef">for</span> <span style="color: #f8f8f2">line</span> <span style="color: #f92672">in</span> <span style="color: #f8f8f2">open(</span><span style="color: #e6db74">&quot;ptOutput.txt&quot;</span><span style="color: #f8f8f2">,</span><span style="color: #e6db74">&quot;r&quot;</span><span style="color: #f8f8f2">))</span>
<span style="color: #f8f8f2">ctSet</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">set(line</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">split(</span><span style="color: #e6db74">&quot; &quot;</span><span style="color: #f8f8f2">)[</span><span style="color: #ae81ff">2</span><span style="color: #f8f8f2">]</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">strip()</span> <span style="color: #66d9ef">for</span> <span style="color: #f8f8f2">line</span> <span style="color: #f92672">in</span> <span style="color: #f8f8f2">open(</span><span style="color: #e6db74">&quot;ctOutput.txt&quot;</span><span style="color: #f8f8f2">,</span><span style="color: #e6db74">&quot;r&quot;</span><span style="color: #f8f8f2">))</span>

<span style="color: #f8f8f2">collision</span> <span style="color: #f92672">=</span>  <span style="color: #f8f8f2">ptSet</span> <span style="color: #f92672">&amp;</span> <span style="color: #f8f8f2">ctSet</span>
<span style="color: #66d9ef">print</span> <span style="color: #e6db74">&quot;Collision &gt; &quot;</span> <span style="color: #f92672">+</span> <span style="color: #f8f8f2">collision</span>


<span style="color: #75715e"># Stage 2 - Get Key</span>

<span style="color: #f8f8f2">key</span> <span style="color: #f92672">=</span> <span style="color: #e6db74">&quot;&quot;</span>
<span style="color: #66d9ef">with</span> <span style="color: #f8f8f2">open(</span><span style="color: #e6db74">&quot;ptOutput.txt&quot;</span><span style="color: #f8f8f2">,</span><span style="color: #e6db74">&quot;r&quot;</span><span style="color: #f8f8f2">)</span> <span style="color: #66d9ef">as</span> <span style="color: #f8f8f2">f:</span>
  <span style="color: #66d9ef">for</span> <span style="color: #f8f8f2">line</span> <span style="color: #f92672">in</span> <span style="color: #f8f8f2">f:</span>
    <span style="color: #66d9ef">if</span> <span style="color: #f8f8f2">line</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">split(</span><span style="color: #e6db74">&quot; &quot;</span><span style="color: #f8f8f2">)[</span><span style="color: #ae81ff">2</span><span style="color: #f8f8f2">]</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">strip()</span> <span style="color: #f92672">==</span> <span style="color: #f8f8f2">collision:</span>
      <span style="color: #66d9ef">print</span> <span style="color: #e6db74">&quot;Left side key &gt; &quot;</span> <span style="color: #f92672">+</span> <span style="color: #f8f8f2">line</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">split(</span><span style="color: #e6db74">&quot; &quot;</span><span style="color: #f8f8f2">)[</span><span style="color: #ae81ff">0</span><span style="color: #f8f8f2">]</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">strip()</span>
      <span style="color: #f8f8f2">key</span> <span style="color: #f92672">+=</span> <span style="color: #f8f8f2">line</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">split(</span><span style="color: #e6db74">&quot; &quot;</span><span style="color: #f8f8f2">)[</span><span style="color: #ae81ff">0</span><span style="color: #f8f8f2">]</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">strip()</span>
<span style="color: #66d9ef">with</span> <span style="color: #f8f8f2">open(</span><span style="color: #e6db74">&quot;ctOutput.txt&quot;</span><span style="color: #f8f8f2">,</span><span style="color: #e6db74">&quot;r&quot;</span><span style="color: #f8f8f2">)</span> <span style="color: #66d9ef">as</span> <span style="color: #f8f8f2">f:</span>
  <span style="color: #66d9ef">for</span> <span style="color: #f8f8f2">line</span> <span style="color: #f92672">in</span> <span style="color: #f8f8f2">f:</span>
    <span style="color: #66d9ef">if</span> <span style="color: #f8f8f2">line</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">split(</span><span style="color: #e6db74">&quot; &quot;</span><span style="color: #f8f8f2">)[</span><span style="color: #ae81ff">2</span><span style="color: #f8f8f2">]</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">strip()</span> <span style="color: #f92672">==</span> <span style="color: #f8f8f2">collision:</span>
      <span style="color: #66d9ef">print</span> <span style="color: #e6db74">&quot;Right side key &gt; &quot;</span> <span style="color: #f92672">+</span> <span style="color: #f8f8f2">line</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">split(</span><span style="color: #e6db74">&quot; &quot;</span><span style="color: #f8f8f2">)[</span><span style="color: #ae81ff">0</span><span style="color: #f8f8f2">]</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">strip()</span>
      <span style="color: #f8f8f2">key</span> <span style="color: #f92672">+=</span> <span style="color: #f8f8f2">line</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">split(</span><span style="color: #e6db74">&quot; &quot;</span><span style="color: #f8f8f2">)[</span><span style="color: #ae81ff">0</span><span style="color: #f8f8f2">]</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">strip()</span>
<span style="color: #66d9ef">print</span> <span style="color: #e6db74">&quot;Key &gt; &quot;</span> <span style="color: #f92672">+</span> <span style="color: #f8f8f2">key</span>


<span style="color: #75715e"># Stage 3 - Get Flag</span>

<span style="color: #f8f8f2">flag</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">b</span><span style="color: #e6db74">&#39;04b34e5af4a1f5260f6043b8b9abb4f8&#39;</span>
<span style="color: #f8f8f2">key</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">unhexlify(key)</span>

<span style="color: #66d9ef">def</span> <span style="color: #a6e22e">not_so_fun_anymore</span><span style="color: #f8f8f2">(key,ct):</span>
  <span style="color: #66d9ef">assert</span> <span style="color: #f8f8f2">len(key)</span> <span style="color: #f92672">==</span> <span style="color: #ae81ff">2</span> <span style="color: #f92672">*</span> <span style="color: #f8f8f2">KEY_LENGTH</span>
  <span style="color: #f8f8f2">key1</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">key[:KEY_LENGTH]</span>
  <span style="color: #f8f8f2">key2</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">key[KEY_LENGTH:]</span>

  <span style="color: #f8f8f2">hash</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">no_fun_allowed(key2,</span> <span style="color: #f8f8f2">ct)</span>
  <span style="color: #f8f8f2">pt</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">no_fun_allowed(key1,hash)</span>
  <span style="color: #66d9ef">return</span> <span style="color: #f8f8f2">pt</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">decode(</span><span style="color: #e6db74">&quot;hex&quot;</span><span style="color: #f8f8f2">)</span>

<span style="color: #66d9ef">print</span> <span style="color: #e6db74">&quot;hackim19{&quot;</span> <span style="color: #f92672">+</span> <span style="color: #f8f8f2">not_so_fun_anymore(key,flag)</span> <span style="color: #f92672">+</span> <span style="color: #e6db74">&quot;}&quot;</span>
</pre></div>
